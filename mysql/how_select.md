### 一、连接器

建立连接、管理连接、校验用户身份

### 二、查询缓存

查询缓存 (Query Cache)：以 key-value 形式存在内存。key -> SQL 查询语句，value -> SQL 查询语句结果。

只要表有更新操作，查询缓存就会清空。
关闭缓存：query_cache_type=DEMAND
MySQL 8.0 移除了 Server 层的查询缓存，不是 InnoDB 存储引擎的 buffer pool.

### 三、解析 SQL

#### 解析器

1. 词法分析：构建语法树
2. 语法分析：检查语法

解析器只负责构建语法树和检查语法，不会查表或字段是否存在。

### 四、执行 SQL

三个阶段：
1. prepare 阶段，预处理阶段
2. optimize 阶段，优化阶段
3. execute 阶段，执行阶段

#### 预处理器

- 检查 SQL 语句中的表或字段是否存在
- 将 `select *` 中的 `*` 符号扩展为表上的所有列

#### 优化器

基于查询成本的考虑，选择查询成本最小的执行计划
主要负责将 SQL 查询语句的执行方案确定下来

#### 执行器

根据执行计划执行 SQL 查询语句，从存储引擎读取记录，返回给客户端

执行器和存储引擎的交互过程：
- 主键索引查询：访问类型为 const
- 全表扫描：访问类型为 ALL
- 索引下推：Extra=Using index condition，能够减少二级索引在查询时的回表操作，提高查询效率，它将 Server 层部分负责的事情交给存储引擎层去处理了

让存储引擎读取表中第一天记录

联合索引当遇到范围查询（>、<）就会停止匹配
